#!/usr/bin/env bash
set -euo pipefail

BUILD_DIR="${1}"
CACHE_DIR="${2}"
DEPS_DIR="${3}"
DEPS_IDX="${4}"

GRAFANA_VERSION="${GRAFANA_VERSION:-6.0.1}"
GRAFANA_DOWNLOAD_URL="https://dl.grafana.com/oss/release/grafana-${GRAFANA_VERSION}.linux-amd64.tar.gz"

BUILDPACK_DIR=$(dirname $(readlink -f ${BASH_SOURCE%/*}))
GRAFANA_DIR="${DEPS_DIR}/grafana"

[ -f "${BUILD_DIR}/runtime.txt" ] && GRAFANA_DOWNLOAD_URL=$(cat "${BUILD_DIR}/runtime.txt")
echo "-----> Downloading Grafana: ${GRAFANA_DOWNLOAD_URL}"
wget "${GRAFANA_DOWNLOAD_URL}" -O "${CACHE_DIR}/grafana.tar"

echo "-----> Installing Grafana"
mkdir -p ${DEPS_DIR}/grafana
tar -zxf ${CACHE_DIR}/grafana.tar -C ${DEPS_DIR}/grafana --strip-components 1

