#!/usr/bin/env bash
set -euo pipefail

BUILD_DIR="${1}"
CACHE_DIR="${2}"
DEPS_DIR="${3}"
DEPS_IDX="${4}"

BUILDPACK_DIR=$(dirname $(readlink -f ${BASH_SOURCE%/*}))
GRAFANA_DIR="${DEPS_DIR}/grafana"

echo "-----> Symlinking properties and default configuration"
rm -rf "${GRAFANA_DIR}/conf/provisioning"
cp ${BUILDPACK_DIR}/defaults.ini "${GRAFANA_DIR}/conf/"
ln -sf /home/vcap/app "${GRAFANA_DIR}/conf/provisioning"

echo "-----> Creating startup script"
cp ${BUILDPACK_DIR}/grafana.sh ${GRAFANA_DIR}/grafana.sh
chmod +x ${GRAFANA_DIR}/grafana.sh

